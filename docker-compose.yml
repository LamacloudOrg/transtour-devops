version: "3"

services: 
  adminer: 
    image: adminer
    container_name: db_admin
    networks:
      - local
    ports: 
      - "8082:8080"
    restart: always

  db: 
    environment: 
        MYSQL_ROOT_PASSWORD: 1234
        MYSQL_DATABASE: transtour
        MYSQL_USER: transtourRoot      
        MYSQL_PASSWORD: transtourRoot
    image: "mysql:5.7"
    ports: 
      - "8081:3306"
    restart: always
    container_name: mysqldb
    networks:
      - local
    volumes: 
      - "db_data:/var/lib/mysql"
      - $HOME/repositories/transtour/db.sql:/db.sql

  wiremock:
    image: "holomekc/wiremock-gui:latest"
    container_name: wiremock
    restart: always
    ports: 
      - "8088:8089"
      - "8084:8089"
    networks:
      - local
    environment:
      WIREMOCK_OPTIONS: "--port=8089,--https-port=8088,--max-request-journal=1000,--global-response-templating,--root-dir=/home/wiremock/storage"

  voucher:
    build: ../transtour-backend-voucher
    image: voucher_api:1.0
    container_name: voucher_api
    restart: always
    volumes :
      - "vouchers:/opt/app/pdf"
    ports: 
      - "9092:9092"
    networks:
      - local

  travel:
    build: ../transtour-backend
    image: travel_api:1.0
    container_name: travel_api
    restart: always
    volumes :
      - "travel:/var/lib/data"
    ports: 
      - "9091:9091"
    networks:
      - local
    environment:
      - "SPRING_PROFILES_ACTIVE=development"

  server:
    build: ./transtour-server
    container_name: server_api
    image: server_api:1.0
    restart: always
    networks:
      - local
    volumes :
      - "./transtour-server/log:/var/temp/log_file"
    depends_on:
      - voucher
      - travel
    networks:
      - local
    ports: 
      - "9090:80"
    #links:
     # - voucher
    #  - travel


volumes: 
  db_data: {}
  vouchers: {}
  travel: {}

networks:
  local:
    driver: bridge
